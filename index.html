<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal de Estudiante - Melody Method</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 min-h-screen p-4 md:p-8">
    <div class="max-w-2xl mx-auto bg-white rounded-2xl shadow-xl overflow-hidden">
        <div class="bg-indigo-600 p-6 text-white text-center">
            <h1 id="curso-nombre" class="text-2xl font-bold">Cargando curso...</h1>
            <p id="alumno-nombre" class="opacity-90">Selecciona tu archivo JSON</p>
        </div>

        <div class="p-6">
            <input type="file" id="jsonFile" accept=".json" class="mb-6 block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100">
            
            <div id="lecciones-container" class="space-y-4">
                </div>
        </div>
    </div>

    <script>
        document.getElementById('jsonFile').addEventListener('change', function(e) {
            const reader = new FileReader();
            reader.onload = function(event) {
                const data = JSON.parse(event.target.result);
                document.getElementById('curso-nombre').textContent = data.curso;
                document.getElementById('alumno-nombre').textContent = "Estudiante: " + data.alumno;
                
                const container = document.getElementById('lecciones-container');
                container.innerHTML = '';

                data.lecciones.forEach(leccion => {
                    const div = document.createElement('div');
                    div.className = "border rounded-xl p-4 bg-slate-50";
                    
                    // Ajustamos el link de Dropbox para que sea directo
                    let audioUrl = leccion.audio.replace('www.dropbox.com', 'dl.dropboxusercontent.com').replace('?dl=0', '');
                    if (!audioUrl.includes('raw=1')) {
                        audioUrl += (audioUrl.includes('?') ? '&' : '?') + 'raw=1';
                    }

                    div.innerHTML = `
                        <h3 class="font-bold text-lg text-indigo-900">${leccion.title}</h3>
                        <p class="text-slate-600 my-2 italic">"${leccion.text}"</p>
                        <audio controls class="w-full mt-2" src="${audioUrl}"></audio>
                    `;
                    container.appendChild(div);
                });
            };
            reader.readAsText(e.target.files[0]);
        });
    </script>
</body>
</html>
